<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/layout}" layout:fragment="content">
<head>
    <meta charset="UTF-8">
    <title>Animal Data</title>
    <style>
        .card {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 16px;
            margin: 16px;
            display: inline-block;
            width: 300px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .card img {
            width: 100%;
            height: auto;
            border-radius: 4px;
        }
        .card-content {
            margin-top: 12px;
        }
    </style>
</head>
<body>
<h1>Animal Data</h1>
<form id="searchList" method="POST">
    <fieldset>
        <legend>검색조건</legend>
        <div class="tr">
            <div class="form-group date">
                <label class="lable">날짜</label>
                <input type="date" name="searchSDate" id="searchSDate" class="form-control" title="시작일" maxlength="10">
                <div class="hyphen">~</div>
                <input type="date" name="searchEDate" id="searchEDate" class="form-control" title="마감일" maxlength="10">
                <label class="lable">(접수일 기준)</label>
            </div>
        </div>
        <div class="tr">
            <div class="form-group">
                <label class="lable">시도</label>
                <select class="form-control" name="searchUprCd" id="searchUprCd" title="시도선택">
                    <option value="6110000">서울특별시</option>
                    <option value="6260000">부산광역시</option>
                </select>
            </div>
            <div class="form-group">
                <label class="lable">시군구</label>
                <select class="form-control" name="searchOrgCd" id="searchOrgCd" title="시군구선택"></select>
            </div>
        </div>
        <div class="tr">
            <div class="form-group">
                <label class="lable">품종</label>
                <select class="form-control" name="searchKindCd" id="searchKindCd" title="종류선택">
                    <option value="">전체</option>
                    <option value="000114">믹스견</option>
                    <option value="000072">말티즈</option>
                    <option value="000054">골든 리트리버</option>
                    <option value="000056">그레이 하운드</option>
                </select>
            </div>
        </div>
        <div class="action-btn-group">
            <div class="center">
                <button type="button" class="btn btn-primary w-md" id="searchButton">
                    <i class="icon-search"></i>조회
                </button>
            </div>
        </div>
    </fieldset>
</form>
<div id="animalList"></div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const searchSDate = document.getElementById("searchSDate");
        const searchEDate = document.getElementById("searchEDate");
        const searchButton = document.getElementById("searchButton");
        const animalList = document.getElementById("animalList");

        const now = new Date();
        const twoMonthsAgo = new Date();
        twoMonthsAgo.setMonth(now.getMonth() - 2);

        searchSDate.value = twoMonthsAgo.toISOString().split('T')[0];
        searchEDate.value = now.toISOString().split('T')[0];

        const districts = {
            "6110000": [
                { value: "3220000", text: "강남구" },
                { value: "3240000", text: "강동구" }
            ],
            "6260000": [
                { value: "3360000", text: "강서구" }
            ]
        };

        const searchUprCd = document.getElementById("searchUprCd");
        const searchOrgCd = document.getElementById("searchOrgCd");

        // 페이지 로드 시 초기화
        loadDistricts(searchUprCd.value);

        // 시도가 변경되었을 때 해당 시도에 속하는 시군구 로드
        searchUprCd.addEventListener("change", function() {
            const selectedUprCd = this.value;
            loadDistricts(selectedUprCd);
        });

        // 해당 시도에 속하는 시군구 로드하는 함수
        function loadDistricts(uprCd) {
            searchOrgCd.innerHTML = ""; // 시군구 선택 목록 초기화
            const districtList = districts[uprCd]; // 선택된 시도의 시군구 목록 가져오기
            districtList.forEach(function(district) {
                const option = new Option(district.text, district.value);
                searchOrgCd.appendChild(option);
            });
        }

        // 조회 버튼 클릭 시 이벤트 핸들러
        searchButton.addEventListener("click", function() {
            const formData = new FormData();
            formData.append("searchSDate", searchSDate.value);
            formData.append("searchEDate", searchEDate.value);
            formData.append("searchUprCd", searchUprCd.value);
            formData.append("searchOrgCd", searchOrgCd.value);
            formData.append("searchKindCd", document.getElementById("searchKindCd").value);

            fetch('/adoption/search', {
                method: 'POST',
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    animalList.innerHTML = "";
                    data.forEach(animalDetail => {
                        const card = document.createElement("div");
                        card.className = "card";
                        card.innerHTML = `
                        <a href="${animalDetail.detailUrl}">
                        <img src="${animalDetail.imageUrl}" alt="Animal Image"></a>
                        <div class="card-content">
                            <p>공고번호: ${animalDetail.noticeNo}</p>
                            <p>품종: ${animalDetail.breed}</p>
                            <p>색상: ${animalDetail.color}</p>
                            <p>성별: ${animalDetail.sex}</p>
                            <p>중성화 여부: ${animalDetail.neuterStatus}</p>
                            <p>발생장소: ${animalDetail.foundLocation}</p>
                            <p>접수일시: ${animalDetail.receivedDate}</p>
                            <p>관할기관: ${animalDetail.jurisdiction}</p>
                            <p>보호센터: ${animalDetail.shelterName}</p>
                            <p>보호장소: ${animalDetail.shelterAddress}</p>
                        </div>
                    `;
                        animalList.appendChild(card);
                    });
                })
                .catch(error => console.error('Error:', error));
        });
    });
</script>
</body>
</html>
